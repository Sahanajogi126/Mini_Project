<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automated Quiz Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/style.css') }}">

</head>
<body>
    <div class="container">
        <div class="logo">AQ</div>
        <h1>Automated Quiz Generator</h1>
        <p>Upload a PDF or paste text to generate your quiz</p>

        <form action="/prepare" method="post" enctype="multipart/form-data" id="upload-form">
            <div class="btn-group">
                <label class="btn" id="upload-btn-label">üìò Upload PDF
                    <input id="pdf-input" type="file" name="pdf" accept="application/pdf" hidden>
                </label>
                <button type="button" class="btn secondary" id="text-toggle-btn">üñä Paste Text</button>
            </div>

            <div id="text-input-container" style="display: none; margin-bottom: 20px;">
                <textarea id="text-input" name="text_content" placeholder="Paste your text content here..." class="text-input"></textarea>
            </div>

            <!-- question type selection moved to separate step -->
            <input type="hidden" name="input_mode" id="input-mode" value="file">

            <div class="upload-box">
                <p id="file-name">No file selected</p>
                <div id="pdf-preview" style="display: none;">
                    <button type="button" id="preview-pdf-btn" class="btn secondary">üëÅ View PDF File</button>
                </div>
            </div>

            <div class="action-buttons" style="justify-content: center;">
                <button type="submit" class="btn generate" id="start-btn">Next ‚Üí</button>
            </div>
        </form>

        
    </div>

    <script>
        (function() {
            const input = document.getElementById('pdf-input');
            const fileName = document.getElementById('file-name');
            const textInput = document.getElementById('text-input');
            const textContainer = document.getElementById('text-input-container');
            const textToggleBtn = document.getElementById('text-toggle-btn');
            const uploadBtnLabel = document.getElementById('upload-btn-label');
            const inputMode = document.getElementById('input-mode');
            const typeButtons = document.querySelectorAll('.question-type .btn');
            const hiddenType = document.getElementById('question-type');
            const form = document.getElementById('upload-form');

            let isTextMode = false;

            // Toggle between file upload and text mode
            if (textToggleBtn) {
                textToggleBtn.addEventListener('click', () => {
                    isTextMode = !isTextMode;
                    if (isTextMode) {
                        textContainer.style.display = 'block';
                        textToggleBtn.textContent = 'üìò Upload PDF';
                        uploadBtnLabel.style.display = 'none';
                        input.removeAttribute('required');
                        inputMode.value = 'text';
                        fileName.textContent = 'Text mode - paste content above';
                    } else {
                        textContainer.style.display = 'none';
                        textToggleBtn.textContent = 'üñä Paste Text';
                        uploadBtnLabel.style.display = 'block';
                        input.setAttribute('required', 'required');
                        inputMode.value = 'file';
                        fileName.textContent = 'No file selected';
                    }
                });
            }

            if (input && fileName) {
                input.addEventListener('change', function() {
                    let name = 'No file selected';
                    if (this.files && this.files.length > 0) {
                        name = this.files[0].name;
                    } else if (this.value) {
                        const p = this.value;
                        name = p.split('\\').pop().split('/').pop();
                    }
                    fileName.textContent = name;
                    const previewDiv = document.getElementById('pdf-preview');
                    if (name !== 'No file selected') {
                        previewDiv.style.display = 'block';
                    } else {
                        previewDiv.style.display = 'none';
                    }
                });
            }

            if (textInput) {
                textInput.addEventListener('input', function() {
                    if (this.value.trim()) {
                        const wordCount = this.value.trim().split(/\s+/).length;
                        fileName.textContent = `Text content (${wordCount} words)`;
                        const previewDiv = document.getElementById('pdf-preview');
                        previewDiv.style.display = 'none'; // No preview for text mode
                    } else {
                        fileName.textContent = 'Text mode - paste content above';
                        const previewDiv = document.getElementById('pdf-preview');
                        previewDiv.style.display = 'none';
                    }
                });
            }

            // PDF preview functionality
            const previewPdfBtn = document.getElementById('preview-pdf-btn');
            
            if (previewPdfBtn) {
                previewPdfBtn.addEventListener('click', function() {
                    // If a file is selected, preview it directly without uploading
                    if (input && input.files && input.files[0]) {
                        const localUrl = URL.createObjectURL(input.files[0]);
                        window.open(localUrl, '_blank');
                        return;
                    }
                    // Fallback to server preview if available
                    window.open('/view_pdf', '_blank');
                });
            }

            // Question type selection
            typeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    typeButtons.forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    hiddenType.value = btn.getAttribute('data-type');
                });
            });

            // Block submit until a file or text is provided (question type is chosen on the next page)
            if (form) {
                form.addEventListener('submit', (e) => {
                    if (isTextMode && !textInput.value.trim()) {
                        e.preventDefault();
                        alert('Please paste some text content.');
                        return;
                    }
                    if (!isTextMode && (!input.files || input.files.length === 0)) {
                        e.preventDefault();
                        alert('Please select a PDF file or switch to text mode.');
                        return;
                    }
                });
            }
        })();
    </script>
</body>
</html>
